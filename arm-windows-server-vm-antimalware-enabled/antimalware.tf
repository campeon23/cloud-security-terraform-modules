resource "azurerm_virtual_machine_extension" "antimalware" {
  name                 = "MicrosoftAntimalware"
  virtual_machine_id   = azurerm_virtual_machine.vm.id
  publisher            = "Microsoft.Azure.Security"
  type                 = "IaaSAntimalware"
  type_handler_version = "1.5"

  settings = <<SETTINGS
    {
      "AntimalwareEnabled": true,
      "RealtimeProtectionEnabled": true
    }
SETTINGS

  protected_settings = <<PROTECTED_SETTINGS
    {
      "Exclusions": {
        "Extensions": ".log",
        "Paths": "",
        "Processes": "SQLServr.exe"
      }
    }
PROTECTED_SETTINGS
}